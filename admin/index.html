<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ALSAQQAF LOGISTICS LLC — Admin Dashboard</title>
  <link rel="icon" href="/favicon.png" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <!-- your full HTML content exactly as it was originally, including all layout, tabs, and elements -->
  <!-- keep everything from your uploaded admin dashboard design here -->

  <!-- Backend integration (keep this script at the bottom) -->
  <script>
    async function fetchApplications() {
      const res = await fetch('/api/applications', { credentials: 'same-origin' });
      if (!res.ok) throw new Error('Failed to load applications');
      const data = await res.json();
      return (data || []).map(a => ({
        id: a.id || (a.email || 'APP') + '-' + (a.submittedAt || ''),
        date: a.submittedAt ? new Date(a.submittedAt).toISOString().slice(0, 10) : '',
        name: ((a.firstName || '') + ' ' + (a.lastName || '')).trim(),
        email: a.email || '',
        phone: a.phone || '',
        cdlClass: a.cdlClass || '',
        experience: a.drivingExperience || a.experience || '',
        status: (a.status && ['approved', 'pending', 'rejected'].includes(a.status))
          ? a.status : 'pending',
        _raw: a
      }));
    }

    async function postStatusUpdate(id, status) {
      const res = await fetch('/api/applications/update', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        credentials: 'same-origin',
        body: JSON.stringify({ id, status })
      });
      return res.ok;
    }

    function refreshAllData() {
      fetchApplications()
        .then(arr => {
          applicationsData = arr;
          loadAllApplications();
          updateDashboardStats();
          loadRecentApplications();
          updateAnalytics();
        })
        .catch(err => {
          console.error(err);
          showNotification('Could not load applications from server.', 'error');
        });
    }

    function approveApplication(appId) {
      const app = applicationsData.find(a => a.id === appId);
      if (!app) return;
      app.status = 'approved';
      postStatusUpdate(app._raw?.id || appId, 'approved')
        .then(ok => {
          if (!ok) showNotification('Server did not accept the update (UI updated only).', 'warning');
          else showNotification('✅ Application approved successfully!', 'success');
          refreshAllData();
          closeModal('applicationModal');
        })
        .catch(() => {
          showNotification('Could not reach server to update status.', 'error
